<!--
   player.html
   
   Copyright 2017 Shao Wei <chong@meta-p02>
   
   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.
   
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
   
   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
   MA 02110-1301, USA.
   
   
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>Live Simulator</title>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<script src="./structures.js"></script>
	<script src="./graphics.js"></script>
	<script src="./bandori.js"></script>
	<script src="./sif.js"></script>
	<script src="./timing.js"></script>
</head>

<body>
	<canvas id="canvas" height=600 width=960></canvas>=
	<br />
	<button onclick="startSim()" height=15 width=35>Start</button>
	<button onclick="stopSim()" height=15 width=35>Stop</button>
	<script type="text/javascript">
		function _draw(ctx,notes,start){
			var curTime=(+(new Date().getTime())-start)/1000.0;
			ctx.reset();
			for(var i=0;i<notes.length;i++){
				if(notes[i].isVisible(curTime,ctx.approachTime)){
					if(notes[i].noteType=="LN"){
						try{ctx.drawLN(curTime,notes[i]);}catch(e){console.log(e);}
					} else {
						ctx.drawNote(curTime,notes[i]);
					}
				}
			}
		}
		function startSim(){
			var startTime=+(new Date().getTime());
			setInterval(_draw,1000/240.0,c,notelist,startTime);
		}
		function stopSim(){
			clearInterval(_draw);
		}
		
		var notelist = [
			new Note([0,2,0.0],6,Note.HIT),
			new LN(
				[[[0,2,0.0],0],
				[[0,2,0.5],1],
				[[0,2,1.0],2],
				[[0,2,1.5],3],
				[[0,2,2.0],2],
				[[0,2,2.5],1],
				[[0,2,3.0],0,Note.SWIPE]]),
			new Note([0,2,0.5],6,Note.HIT),
			new Note([0,2,1.0],5,Note.HIT),
			new Note([0,2,1.5],5,Note.HIT),
			new Note([0,2,2.0],4,Note.HIT),
			new Note([0,2,2.5],4,Note.HIT),
			new Note([0,2,3.0],3,Note.HIT),
			new LN(
				[[[0,3,0.0],6],
				[[0,3,3.5],3],
				[[0,4,0.0],5],
				[[0,4,3.5],4,Note.LN_END]]),
			new LN(
				[[[0,3,0.5],3],
				[[0,3,1.0],2,Note.SWIPE]]),
			new LN(
				[[[0,3,1.5],2],
				[[0,3,2.0],1,Note.SWIPE]]),
			new LN(
				[[[0,3,2.5],1],
				[[0,3,3.0],0,Note.SWIPE]]),
			new Note([0,4,0.5],0,Note.HIT),
			new Note([0,4,1.0],3,Note.SWIPE),
			new Note([0,4,1.5],0,Note.HIT),
			new Note([0,4,2.0],2,Note.SWIPE),
			new Note([0,4,2.5],0,Note.HIT),
			new Note([0,4,3.0],1,Note.SWIPE),			
		];
		/*
		var notelist = [
			new Note(2,2.4,Note.HIT),
			new Note(6,2.5,Note.HIT),
			new Note(3,2.6,Note.HIT),
			new Note(5,2.7,Note.HIT),
			new Note(4,2.8,Note.HIT),
			new Note(2,3.2,Note.HIT),
			new Note(6,3.3,Note.HIT),
			new Note(3,3.4,Note.HIT),
			new Note(5,3.5,Note.HIT),
			new Note(4,3.6,Note.HIT),
		];
		*/
		var c=new GameContext();
		c.approachTime=1.1;
		c.initialise("bandori");
		
		var timing=new TimingInfo([
			{ "offset" : 0, "bpm" : 120, "measure" : 4 }]);
		timing.autoConvert(notelist);
	</script>
	
</body>

</html>
